---
import Layout from './main.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

interface RelatedPost {
	id: string;
	data: {
		title: string;
		description: string;
		tags: string[];
		publishedDate: string;
	};
}

interface Props {
	title: string;
	description: string;
	publishedDate: string;
	modifiedDate?: string;
	author: string;
	tags: string[];
	keywords: string[];
	ogImage?: string;
	relatedPosts?: RelatedPost[];
}

const { title, description, publishedDate, modifiedDate, author, tags, keywords, ogImage, relatedPosts = [] } = Astro.props;

const articleJsonLd = {
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": title,
	"description": description,
	"datePublished": publishedDate,
	"dateModified": modifiedDate || publishedDate,
	"author": {
		"@type": "Person",
		"name": author,
	},
	"publisher": {
		"@type": "Organization",
		"name": "Chis",
		"url": "https://trychis.com",
		"logo": "https://trychis.com/logo.png",
	},
	"mainEntityOfPage": {
		"@type": "WebPage",
		"@id": Astro.url.href,
	},
	"keywords": keywords.join(", "),
};
---

<Layout
	title={`${title} | Chis Blog`}
	description={description}
	ogType="article"
	ogImage={ogImage}
	publishedDate={publishedDate}
	modifiedDate={modifiedDate}
	author={author}
	keywords={keywords}
>
	<Nav activePage="blog" />

	<main class="pt-24 pb-20 px-6">
		<article class="max-w-3xl mx-auto">
			<header class="mb-10">
				<a href="/blog" class="text-sm text-brand-400 hover:text-brand-200 transition-colors mb-4 inline-block">
					&larr; Back to Blog
				</a>
				<h1 class="text-3xl sm:text-4xl font-bold text-white leading-tight tracking-tight mt-2">
					{title}
				</h1>
				<div class="mt-4 flex items-center gap-4 text-sm text-surface-400">
					<span>{author}</span>
					<span>&middot;</span>
					<time datetime={publishedDate}>
						{new Date(publishedDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
					</time>
				</div>
				<div class="mt-4 flex flex-wrap gap-2">
					{tags.map((tag) => (
						<span class="px-2.5 py-0.5 text-xs font-medium text-brand-400 bg-brand-500/10 border border-brand-500/20 rounded-full">
							{tag}
						</span>
					))}
				</div>
			</header>

			<div class="article-content">
				<slot />
			</div>

			{relatedPosts.length > 0 && (
			<nav class="mt-16" aria-label="Related articles">
				<h2 class="text-xl font-bold text-white mb-6">Related Articles</h2>
				<div class="grid sm:grid-cols-3 gap-4">
					{relatedPosts.map((related) => (
						<a href={`/blog/${related.id}`} class="group block rounded-xl border border-surface-800 bg-surface-900 p-5 hover:border-surface-700 transition-colors">
							<div class="flex flex-wrap gap-1.5 mb-2">
								{related.data.tags.slice(0, 2).map((tag) => (
									<span class="px-2 py-0.5 text-xs font-medium text-brand-400 bg-brand-500/10 border border-brand-500/20 rounded-full">
										{tag}
									</span>
								))}
							</div>
							<h3 class="text-sm font-semibold text-white group-hover:text-brand-400 transition-colors leading-snug">
								{related.data.title}
							</h3>
							<time datetime={related.data.publishedDate} class="mt-2 block text-xs text-surface-500">
								{new Date(related.data.publishedDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
							</time>
						</a>
					))}
				</div>
			</nav>
		)}

		<div class="mt-16 rounded-xl border border-surface-800 bg-surface-900 p-8 text-center">
				<h2 class="text-2xl font-bold text-white">Ready to stop building webhook plumbing?</h2>
				<p class="mt-3 text-surface-400">
					Chis handles retries, logging, and delivery confirmation so you can focus on your product.
				</p>
				<a href="https://app.trychis.com" class="inline-flex items-center mt-6 px-6 py-3 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 transition-colors">
					Get Started Free
				</a>
			</div>
		</article>
	</main>

	<Footer />

	<script type="application/ld+json" set:html={JSON.stringify(articleJsonLd)} />
</Layout>
